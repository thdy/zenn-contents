---
title: "Oktaã‚’IdPã¨ã—ã¦Azure ADã¨ã®ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã™ã‚‹"
emoji: "ğŸª¢"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["okta", "azuread"]
published: true
---
:::message
2023.02.07 è¿½è¨˜
æœ¬è¨˜äº‹ã®å†…å®¹ã¯Okta Classic Engineç’°å¢ƒã‚’å‰æã¨ã—ã¦æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚
Okta Identity Engineç’°å¢ƒã‚’å¯¾è±¡ã¨ã—ãŸAzure ADã¨ã®ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒã‚¤ãƒ†ã‚£ãƒ–ã•ã‚“ã®è¨˜äº‹ãŒãŠã™ã™ã‚ã§ã™â†“

> [Okta Identity Engineã§ã®Azure ADã¨ã®ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã¯ã“ã‚ŒãŒãŠã™ã™ã‚ã ã‚ˆï¼ â€“ CloudNative Inc. BLOGs](https://blog.cloudnative.co.jp/14430/)
:::
# ã¯ã˜ã‚ã«
Oktaã‚’IdPã¨ã—ã¦Azure AD(Microsoft 365)ã¨ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã™ã‚‹éš›ã€[Oktaå…¬å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://help.okta.com/en/prod/Content/Topics/Apps/Office365-Deployment/deploy-main.htm)é€šã‚Šã ã¨ã†ã¾ãã„ã‹ãªã„éƒ¨åˆ†ãŒã‚ã£ãŸã‚Šæ›¸ã„ã¦ãªã„ã“ã¨ãŒã‚ã£ãŸã®ã§ãã®ãƒ¡ãƒ¢ã§ã™ã€‚
é€”ä¸­ã§ãƒãƒã£ãŸãƒã‚¤ãƒ³ãƒˆã«ã¤ã„ã¦ã‚‚æ›¸ã„ã¦ã„ã¾ã™ã€‚

ãªãŠOktaã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸Šã ã¨Office 365ã¨è¡¨è¨˜ã•ã‚Œã¦ã„ã‚‹ï¼ˆæã‚‰ãã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸»ã«è§¦ã‚‹ã®ã¯Office 365ãªã®ã§ãã‚Œã«åˆã‚ã›ã¦ã„ã‚‹ï¼‰ã®ã§ã™ãŒã€å®Ÿéš›ã®æ¥ç¶šå…ˆã¯Azure ADãªã®ã§æœ¬è¨˜äº‹ä¸Šã§ã¯å€‹äººçš„ã«ã‚‚ã—ã£ãã‚Šæ¥ã‚‹ `Azure AD` ã®ã»ã†ã§è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚

# å‰æ
ä»Šå›ã¯ä¸‹è¨˜ã®ã‚·ãƒŠãƒªã‚ªã‚’å‰æã¨ã—ã¦æ§‹æˆã—ãŸä¾‹ã«ãªã‚Šã¾ã™ã€‚
- Oktaã‚’ãƒ¡ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã™ã‚‹
- ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã®Active Directoryã¯ç„¡ã—
- Windows PCã¯Azure AD Join + Intuneã«ã¦ç®¡ç†é‹ç”¨ã—ã¦ã„ã‚‹

ãªãŠOktaã¨Azure ADé–“ã§ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã™ã‚‹ã«ã¯Azure ADã«è¿½åŠ ã—ã¦ã„ã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã”ã¨ã«Oktaå´ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã¾ãŸOktaå´ã‚’ãƒ¡ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã™ã‚‹å ´åˆã€Azure ADå´ã® `{yourtenant}.onmicrosoft.com` ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã¤ã„ã¦ã¯ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å¯¾è±¡å¤–ï¼ˆSSOã‚„ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã¯è¡Œã‚ã‚Œãªã„ï¼‰ã¨ãªã‚Šã¾ã™ã€‚
ğŸ‘‡ã‚¤ãƒ¡ãƒ¼ã‚¸å›³
![](https://storage.googleapis.com/zenn-user-upload/a82246128408545d1a97facb.png)

# Azure ADå´ã®æº–å‚™
### ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’Azure ADã«è¿½åŠ ã™ã‚‹
ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒç„¡ã„ã¨ç´ä»˜ã‘ã‚‹å…ˆãŒç„¡ã„ã®ã§ã€ã‚‚ã—ã¾ã Azure ADã§ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’é‹ç”¨ã—ã¦ã„ãªã‘ã‚Œã°è¿½åŠ ãŒå¿…è¦ã§ã™ã€‚
https://docs.microsoft.com/ja-jp/azure/active-directory/fundamentals/add-custom-domain

### ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ `{yourtenant}.onmicrosoft.com` ã®ã»ã†ã«ã™ã‚‹
`Azure Active Directory > ã‚«ã‚¹ã‚¿ãƒ  ãƒ‰ãƒ¡ã‚¤ãƒ³å` ã®ç”»é¢ã§ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¨­å®šã‚’ç¢ºèªã—ã¾ã™ã€‚
ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾è±¡ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒAzure ADä¸Šã§ãƒ—ãƒ©ã‚¤ãƒãƒªã¨ãªã£ã¦ã„ã‚‹ã¨ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã§ããªã„ã®ã§ã€ãƒ—ãƒ©ã‚¤ãƒãƒªã«ãªã£ã¦ã„ã‚‹å ´åˆã¯åˆ¥ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ãƒ—ãƒ©ã‚¤ãƒãƒªã«è¨­å®šã—ã¾ã™ã€‚
ä»Šå›ã¯ `{yourtenant}.onmicrosoft.com` ã‚’ãƒ—ãƒ©ã‚¤ãƒãƒªã«è¨­å®šã—ã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/d62fe7dc581c26fd7d42b99a.png)

### ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã«ä½¿ç”¨ã™ã‚‹ãŸã‚ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹
ï¼ˆã“ã‚Œã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’Oktaâ‡”Azure ADé–“ã§ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã—ãªã„å ´åˆã¯è¨­å®šä¸è¦ã§ã™ï¼‰
ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã¯ãªã `{yourtenant}.onmicrosoft.com` ã®ã»ã†ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ç®¡ç†è€…ã®ãƒ­ãƒ¼ãƒ«ã‚’å‰²ã‚Šå½“ã¦ã¦ãŠãã¾ã™ã€‚
ãªãŠä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®MFAãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã¨ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¤±æ•—ã™ã‚‹ã®ã§MFAã‚’ç„¡åŠ¹åŒ–ã—ã¦ãŠãã¾ã™ï¼ˆå‚è€ƒï¼š[Office 365 WS-Fed Integration issue](https://support.okta.com/help/s/question/0D51Y00008QoNQN/office-365-wsfed-integration-issue?language=en_US)ï¼‰

å…¨ä½“ã®MFAè¨­å®šã‚’OFFã«ã™ã‚‹ã«ã¯ `Azure Active Directory > ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ > ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®æ—¢å®šå€¤ç¾¤ã®ç®¡ç†` ã«ã¦ `ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®æ—¢å®šå€¤ç¾¤ã®æœ‰åŠ¹åŒ–` ã‚’ `ã„ã„ãˆ` ã«ã—ã¾ã™
![](https://storage.googleapis.com/zenn-user-upload/f4ccbddaa2296dca9ebdd00f.png)

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®æ—¢å®šå€¤ç¾¤ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã¨ã©ã‚“ãªå½±éŸ¿ãŒã‚ã‚‹ã®ã‹ãŒæ°—ã«ãªã‚‹æ–¹ã¯ã“ã¡ã‚‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„
https://docs.microsoft.com/ja-jp/azure/active-directory/fundamentals/concept-fundamentals-security-defaults

ã¾ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®MFAã«ã¤ã„ã¦ã¯ `Azure Active Directory > ãƒ¦ãƒ¼ã‚¶ãƒ¼ > ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã® MFA` ã«ã¦ç¢ºèªã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

# SSOã‚’è¨­å®šã™ã‚‹
ã“ã“ã‹ã‚‰ã¯Oktaã®ç®¡ç†ç”»é¢ã‚’æ“ä½œã—ã¾ã™ã€‚
ãªãŠOktaã«ã¯Microsoft Office 365ã‚’çµ±åˆã™ã‚‹ãŸã‚ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã“ã‚Œã‚’ä½¿ã„ã¾ã™ã€‚

`Applications > Browse App Catalog > Microsoft Office 365 > Add` ã‚’é¸æŠã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/0c7798c5384f5c2018af7b38.png)

## `General Settings`
- Application label
  - ç®¡ç†ç”¨ã®ã‚¢ãƒ—ãƒªåç§°ã‚’è¨­å®šã—ã¾ã™
- Microsoft Tenant Name
  - ä¾‹ã¨ã—ã¦ `thdyjp.onmicrosoft.com` ã¨ã„ã†Azure ADãƒ†ãƒŠãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã“ã“ã«ã¯ `thdyjp` ã¨å…¥åŠ›ã—ã¾ã™
      ![](https://storage.googleapis.com/zenn-user-upload/c683ecc190b6342bf3ffe4d1.png)
- Display the following links
  - Oktaãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«è¡¨ç¤ºã™ã‚‹ã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸æŠã—ã¾ã™
- Seatsï¼ˆOptionalï¼‰
  - ã“ã“ã«è³¼å…¥æ¸ˆã¿ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ•°ã‚’å…¥ã‚Œã¦ãŠãã¨ä½¿ç”¨ç‡ã®ãƒ¬ãƒãƒ¼ãƒˆãŒå‡ºã›ã¾ã™
- Application Visibility
  - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ã‹ã©ã†ã‹ã®è¨­å®šã§ã™
- Browser plugin auto-submit
  - æœ‰åŠ¹ã«ã™ã‚‹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨è‡ªå‹•çš„ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™
ã™ã¹ã¦è¨­å®šã—ãŸã‚‰ `Next` ã‚’é¸æŠã—ã¾ã™

## `Sign-On Optionsãƒ»Required`
- Sign on methods
  - `WS-Federation` ã‚’é¸æŠ
- WS-Federation Configration
  - ã“ã“ã¯ç‰¹åˆ¥ãªç†ç”±ãŒãªã‘ã‚Œã° Okta ã®æ¨å¥¨é€šã‚Š `Automatic (recommended)` ã‚’é¸æŠ
- Office 365 Admin Username
  - Azure AD å´ã§ä½œæˆã—ãŸ `{yourtenant}.onmicrosoft.com` ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å…¥åŠ›
- Office 365 Admin Password
  - å‰è¿°ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
- Office 365 Domains
  - `Fetch and Select` ã‚’é¸æŠã™ã‚‹ã¨ãƒ‰ãƒ¡ã‚¤ãƒ³é¸æŠç”»é¢ãŒå‡ºã‚‹ã®ã§ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾è±¡ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’é¸æŠã—ã¦ `Select`
      ![](https://storage.googleapis.com/zenn-user-upload/42e903f6bf0608da47082f01.png)
  - Default Relay State
    - ã“ã“ã¯ç©ºæ¬„ã§OK
  - Credentials Details
    - ã“ã“ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã®ã¾ã¾
  - Advanced API Access
    - ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’è¡Œã†å ´åˆã¯ã“ã“ã®ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ `Authenticate with Microsoft Office 365` ã‚’é¸æŠ
    - ã‚°ãƒ­ãƒ¼ãƒãƒ«ç®¡ç†è€…ã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’å…¥åŠ›ã™ã‚‹ã¨èªå¯ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ã®ã§ `æ‰¿è«¾` ã‚’é¸æŠ
      ![](https://storage.googleapis.com/zenn-user-upload/b639d3f95aff489451a7be36.png =300x)

        ã“ã®æ™‚Azure ADå´ã®ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸­ã«Graph APIã‚’å©ã„ã¦Azure ADã‚’æ“ä½œã™ã‚‹ãŸã‚ã®ã‚¢ãƒ—ãƒªãŒä½œæˆã•ã‚Œã¾ã™ã€‚ã‚‚ã—Oktaå´ã§Azure ADã¨ã®ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã‚’ã™ã¹ã¦å‰Šé™¤ã—ãŸã„ã¨ãªã£ãŸå ´åˆã¯ã“ã®Okta Microsoft Graph Clientã‚‚å¿˜ã‚Œãšã«å‰Šé™¤ã—ã¾ã—ã‚‡ã†ã€‚
        ![](https://storage.googleapis.com/zenn-user-upload/76f3d095750b4a651636d54b.png)

- `Done` ã‚’é¸æŠ

ã“ã“ã¾ã§ã§SSOã®è¨­å®šã¯å®Œäº†ã€‚
ç¶šã„ã¦ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã®è¨­å®šã‚’é€²ã‚ã¾ã™ã€‚

# ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹
## ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã«ã¤ã„ã¦ç†è§£ã™ã‚‹
Oktaã«ã¦ç”¨æ„ã•ã‚Œã¦ã„ã‚‹Azure ADç”¨ã®ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯4ç¨®é¡ã‚ã‚Šã€ãã‚Œãã‚Œã§ãã‚‹ã“ã¨ãŒé•ã„ã¾ã™ã€‚
ä¸‹è¨˜è¡¨ã«ã¾ã¨ã‚ã¦ã„ã¾ã™ãŒã€å³ã«è¡Œãã»ã©Oktaå´ã§ã§ãã‚‹ã“ã¨ãŒå¢—ãˆã¾ã™ã€‚

| ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹æ“ä½œ         | Licenses and Roles Management Only | Profile Sync | User Sync | Universal Sync |
| ------------------------------ | :--------------------------------: | :----------: | :-------: | :------------: |
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°** |                                    |              |           |                |
| ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¨ãƒ­ãƒ¼ãƒ«ã®å‰²ã‚Šå½“ã¦   |                 â—¯                  |      â—¯       |     â—¯     |       â—¯        |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ                   |                 âœ•                  |      â—¯       |     â—¯     |       â—¯        |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–       |                 â—¯                  |      â—¯       |     â—¯     |       â—¯        |
| Azure ADå´ã§ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†     |                 â—¯                  |      â—¯       |     âœ•     |       âœ•        |
| **ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®åŒæœŸ**         |                                    |              |           |                |
| åŸºæœ¬çš„ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åŒæœŸ       |                 âœ•                  |      â—¯       |     â—¯     |       â—¯        |
| ä¸€éƒ¨ã®æ‹¡å¼µå±æ€§ã®åŒæœŸ           |                 âœ•                  |      âœ•       |     â—¯     |       â—¯        |
| ã™ã¹ã¦ã®æ‹¡å¼µå±æ€§ã®åŒæœŸ         |                 âœ•                  |      âœ•       |     âœ•     |       â—¯        |
| **ADã‚°ãƒ«ãƒ¼ãƒ—ã¨ãƒªã‚½ãƒ¼ã‚¹ã®åŒæœŸ** |                                    |              |           |                |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—           |                 âœ•                  |      âœ•       |     âœ•     |       â—¯        |
| é€£çµ¡å…ˆ                         |                 âœ•                  |      âœ•       |     âœ•     |       â—¯        |
| é…å¸ƒãƒªã‚¹ãƒˆ                     |                 âœ•                  |      âœ•       |     âœ•     |       â—¯        |
| ãƒªã‚½ãƒ¼ã‚¹ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹         |                 âœ•                  |      âœ•       |     âœ•     |       â—¯        |

ãã—ã¦ã“ã‚Œã‚‰ã®ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹å€‹äººçš„æ³¨æ„ãƒã‚¤ãƒ³ãƒˆã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

- **ä¸€åº¦User SyncãŠã‚ˆã³Universal Syncã«ã™ã‚‹ã¨Licenses and Roles Management Onlyã‚„Profile Syncã«ã¯æˆ»ã›ãªã„**
  æˆ»ã—ãŸã„å ´åˆã¯ä¸€åº¦Oktaå´ã§ä½œæˆã—ãŸã‚¢ãƒ—ãƒªã‚’å‰Šé™¤ã—ã¦ã‚¤ãƒã‹ã‚‰ä½œã‚Šç›´ã™ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
  ï¼ˆãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°è¨­å®šã®å¤‰æ›´å¯å¦ã‚¤ãƒ¡ãƒ¼ã‚¸å›³ï¼‰
  ![](https://storage.googleapis.com/zenn-user-upload/50fa8ef5b023911f26f2b939.png =500x)


- **Azure AD Connectã‚’ä½¿ç”¨ã—ã¦ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ADã¨Hyblidç’°å¢ƒã‚’æ§‹æˆã—ã¦ã„ã‚‹ãªã©ã€æ—¢ã«ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹å ´åˆã¯User SyncãŠã‚ˆã³Universal Syncã‚’ä½¿ç”¨ã§ããªã„**
  ãªã®ã§Hyblid Azure AD Joinã‚’æ§‹æˆã—ã¦ã„ã‚‹çµ„ç¹”ã§ã¯å®Ÿè³ªLicenses and Roles Management Onlyã‹Profile Syncã—ã‹é¸ã¹ã¾ã›ã‚“ã€‚

- **User SyncãŠã‚ˆã³Universal Syncã«ã™ã‚‹ã¨Azure ADï¼ˆMicrosoft 365ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼ï¼‰å´ã§ç›´æ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç·¨é›†ã§ããªã„**
  æ™®æ®µã®é‹ç”¨ã§Azure ADå´ã‹ã‚‰ã‚‚ç·¨é›†ã§ãã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã©ã†ã‹ã¯äº‹å‰ã«è€ƒæ…®ã—ã¦é¸æŠã—ã¾ã—ã‚‡ã†ã€‚

- **Oktaå´ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚„ãƒ­ãƒ¼ãƒ«ã®è¡¨è¨˜ã¯Azure ADå´ã¨è‹¥å¹²ç•°ãªã‚‹**
  æ™®æ®µåˆ©ç”¨ã™ã‚‹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’Oktaå´ã«ä½œæˆã—ã¦ãã“ã«ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ã™ã‚‹é‹ç”¨ã«ã™ã‚Œã°æˆ¸æƒ‘ã†ã®ã¯æœ€åˆã ã‘ã§æ¸ˆã‚€ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

## ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’è¨­å®šã™ã‚‹
ã©ã®ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã™ã‚‹ã‹æ±ºã‚ãŸã‚‰ã€å®Ÿéš›ã«è¨­å®šã—ã¾ã™ã€‚

`Provisioning > Integration > Congigure API Integration` ã‚’é¸æŠã—ã€`Enable API Integration` ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ `Admin Username` ã¨ `Admin Password` ã«Azure ADã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ã‚’æŒã£ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ID/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
`Import Groups` ã¯Azure ADå´ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’Oktaã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã‹ã©ã†ã‹ã®è¨­å®šã§ã“ã“ã¯ä»»æ„ã§ã™ã€‚
`Test API Credentials` ã‚’é¸æŠã—ã¦ID/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«èª¤ã‚ŠãŒç„¡ã„ã“ã¨ã‚’ç¢ºèªã§ããŸã‚‰ `Save` ã‚’é¸æŠã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/c3f2feb5fddadafadc471c69.png)

ã“ã‚Œã§ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’è¡Œã†ãŸã‚ã«å¿…è¦ãªæ¨©é™ãŒOktaå´ã«ä¸ãˆã‚‰ã‚Œã€Provisioningã‚¿ãƒ–ã«`To App` ã¨ `To Okta`ãŒå‡ºç¾ã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/171a94ccc7fcf913299a38a7.png =250x)

ã“ã“ã‹ã‚‰ã¯çµ„ç¹”ã®è¦ä»¶ã«å¿œã˜ã¦å¿…è¦ãªãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã®è¨­å®šã‚’ã—ã¾ã™ã€‚
ä»¥ä¸‹ã¯ä¸€ä¾‹ã¨ã—ã¦ã€ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã« `Profile Sync` ã‚’é¸æŠã—ã¦é€²ã‚ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/7cd16ea885456e0611c1b516.png)

Create Usersã€Update User Attributesã€Deactivate Users ã™ã¹ã¦ãƒã‚§ãƒƒã‚¯ã‚’ã¤ã‘ã¾ã™ã€‚ã“ã‚Œã§Oktaã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ãŸã‚Šç„¡åŠ¹åŒ–ã™ã‚‹ã¨Azure ADå´ã«ã‚‚è‡ªå‹•ã§åæ˜ ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/f1f07b37a80fa2a8a62c53a8.png)

ã‚ã¨ã¯å¿…è¦ã«å¿œã˜ã¦Mappingsã§å±æ€§ã®ç´ä»˜ã‘ã‚’è¡Œã„ã€Assignmentã‚¿ãƒ–ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚¢ã‚µã‚¤ãƒ³ã™ã‚Œã°å®Œäº†ã§ã™ã€‚
å®Ÿéš›ã«ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒåŒæœŸã•ã‚Œã¦ã„ã‚‹ã‹ã®ç¢ºèªã‚„ã€ã‚·ãƒ³ã‚°ãƒ«ã‚µã‚¤ãƒ³ã‚ªãƒ³ãŒè¡Œãˆã‚‹ã‹ã©ã†ã‹ã‚’ãƒ†ã‚¹ãƒˆã‚’è¡Œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

# ãƒãƒã£ãŸã“ã¨ã®ãƒ¡ãƒ¢
ã„ã‚ã„ã‚ãƒãƒã£ãŸã®ã§åˆã‚ã›ã¦æ›¸ãæ®‹ã—ã¦ãŠãã¾ã™ã€‚

### Oktaã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§Windows PCã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ã«ãƒãƒã£ãŸ
ã‚·ãƒ³ã‚°ãƒ«ã‚µã‚¤ãƒ³ã‚ªãƒ³ã‚’æ§‹æˆã—ã¦ã„ã‚‹ã®ã«ãªãœãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰åŒæœŸã‚’æœ‰åŠ¹ã«ã™ã‚‹ã®ã‹ã¨ã„ã†ã¨ã€Windows PCã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã¯ã„ã‚ã‚†ã‚‹ãƒ¬ã‚¬ã‚·ãƒ¼èªè¨¼ã§ã‚ã‚Šèªè¨¼ã‚’Oktaã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ã“ã¨ãŒã§ããªã„ãŸã‚ã§ã™ã€‚
Azure AD Joinã—ã¦ã„ã‚‹Windows PCã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’Oktaã¨åŒã˜ã‚‚ã®ã«ã™ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ã—ãŸã‹ã£ãŸã¨ã„ã†ç›®çš„ãŒã‚ã‚Šã¾ã—ãŸã€‚

ãã“ã§Provisioningè¨­å®šã®Sync Passwordã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã€`Sync Okta Password`ã‚’é¸æŠã—ã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/03f40d466d13dd47c345b4db.png)

ã—ã‹ã—å®Ÿéš›ã«Windows PCå´ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«èª¤ã‚ŠãŒã‚ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã®ã§Oktaã‚µãƒãƒ¼ãƒˆã«ç¢ºèªã—ãŸã¨ã“ã‚ã€ã€Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ¬ã‚¬ã‚·ãƒ¼èªè¨¼ã¯è¨±å¯ã•ã‚Œãªã„ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ã§Windowsã‚µã‚¤ãƒ³ã‚¤ãƒ³ã•ã›ãŸã„ãªã‚‰æ‰‹å‹•ã§è¨±å¯ã—ã¦ã­ã€ã¨å›ç­”ãŒã‚ã‚Šã¾ã—ãŸã€‚

ã©ã“ã‚’è¨­å®šã™ã‚‹ã‹ã¨è¨€ã†ã¨`Sign on`ã‚¿ãƒ–ã® `Sign On Policy` ã§ `Add Rule` ã‚’é¸æŠã—ã€`Exchange ActiveSync/Legacy Auth`ã®ã¨ã“ã‚ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã€ã“ã‚Œã ã‘ãªã‚“ã§ã™ãŒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ãªãã¦ãƒãƒã‚Šã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/943f8e2cc02440d136cb88ed.png)

### Immutable IDãŒæ¶ˆãˆãŸ
Immutable IDã¨ã„ã†ã®ã¯Oktaã¨Azure ADã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç´ä»˜ã‘ã‚‹ãŸã‚ã«å¿…è¦ãªå±æ€§å€¤ã§ã€é€šå¸¸ã“ã‚Œã¯è‡ªå‹•çš„ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ã®ã§ã™ãŒæ¤œè¨¼ç­‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚¢ã‚µã‚¤ãƒ³ã—ãŸã‚Šã¯ãšã—ãŸã‚Šè¨­å®šã‚’è‰²ã€…è§¦ã£ã¦ã„ã‚‹ã¨ãªãœã‹æ¶ˆãˆã‚‹ã“ã¨ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚ãã—ã¦ã“ã‚ŒãŒæ¶ˆãˆã‚‹ã¨SSOã‚‚ã†ã¾ãå‹•ä½œã—ã¾ã›ã‚“ã€‚
ã“ã®è¾ºã‚Šã®è©³ç´°ã¯kobasoã•ã‚“ãŒnoteã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã§èˆˆå‘³ã®ã‚ã‚‹æ–¹ã¯èª­ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚

https://note.com/kobaso/n/n6ab079fa0d34

ã§ã€å®Ÿéš›ã«æ¶ˆãˆãŸã‚‰ã©ã†ã™ã‚Œã°è‰¯ã„ã®ã‹ã¨ã„ã†ã¨PowerShellã§é©å½“ãªå€¤ã‚’çªã£è¾¼ã‚€ã—ã‹ãªã„ã‚ˆã†ã§ã™ã€‚

https://support.okta.com/help/s/article/SSO-from-Okta-to-office365-shows-error-AADSTS51004?language=en_US

ãªãŠæ—¢ã«ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã¨ä¸Šè¨˜ãƒ˜ãƒ«ãƒ—ãƒšãƒ¼ã‚¸ã®æ‰‹é †ã§ã¯Immutable IDãŒå¤‰æ›´ã§ããªã‹ã£ãŸã‚Šã—ã¾ã™ã€‚
è‡ªèº«ã®ç’°å¢ƒã§ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«å¯¾å¿œã—ã¾ã—ãŸã€‚

```powershell
Connect-MsolService

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åˆ—æŒ™ã—ã¦Immutable IDãŒæ­£ã—ãã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
Get-MsolUser -DomainName "thdy.jp" | Select-Object UserprincipalName, ImmutableID

// ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ã ã¨Immutable IDã‚’å¤‰æ›´ã§ããªã„ã®ã§ä¸€æ—¦UPNå¤‰æ›´
Set-MsolUserPrincipalName -UserPrincipalName hoge@thdy.jp -NewUserPrincipalName hoge@thdyjp.onmicrosoft.com

// Immutable IDã«æŒ‡å®šã™ã‚‹æ–‡å­—åˆ—ã¯ä½•ã§ã‚‚è‰¯ã„ã®ã§é©å½“ãªå€¤ã‚’ã‚»ãƒƒãƒˆ
Set-MsolUser -UserPrincipalName hoge@thdyjp.onmicrosoft.com -immutableid 2/9JCtHr0EmH+yL07o11vB==

// UPNã‚’ã‚‚ã¨ã«æˆ»ã™
Set-MsolUserPrincipalName -UserPrincipalName hoge@thdyjp.onmicrosoft.com -NewUserPrincipalName hoge@thdy.jp
```

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚¢ã‚µã‚¤ãƒ³ã™ã‚‹å ´åˆã¯ã‚°ãƒ«ãƒ¼ãƒ—ã‚’åˆ©ç”¨ã—ã¦ä¸€æ‹¬ã§ãƒã‚·ãƒƒã¨ã‚¢ã‚µã‚¤ãƒ³ã™ã‚‹ã®ãŒè‰¯ã•ãã†ã§ã™ã€‚
ã¾ãŸã‚¢ã‚µã‚¤ãƒ³å¾Œã« `Get-MsolUser` ã®PowerShellã‚³ãƒãƒ³ãƒ‰ç­‰ã§Immutable IDãŒæ­£ã—ãã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

### Windows Hello for BusinessãŒã€Œè¿½åŠ ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºèªã€ã®è¨­å®šã‚’æ±‚ã‚ã¦ãã‚‹
Azure AD JoinãªWindows PCã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹éš›ã€Windows Hello for Businessã‚’æœ‰åŠ¹ã—ã¦ã„ã‚‹ã¨é€šå¸¸ã¯Azure AD Joinã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æºå¸¯é›»è©±ç•ªå·ã‚„Microsoft Authenticatorãªã©ã®èªè¨¼ã®è¨­å®šã‚’æ±‚ã‚ã‚‹ã€Œè¿½åŠ ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºèªã€ã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
ã—ã‹ã—ä»Šå›Oktaã‚’IdPã¨ã—ãŸã“ã¨ã§MFAã‚‚ã™ã¹ã¦Oktaå´ã§æ¸ˆã¾ã›ã‚‹å‰æã§ã‚ã‚‹ä»¥ä¸Šã€ã“ã‚Œã‚’è¨­å®šã—ãŸã¨ã“ã‚ã§ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å®Ÿéš›ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ãªã‚“ã¨ã‹ã—ã¦ã“ã‚Œã‚’éè¡¨ç¤ºã«ã—ãŸãã¦èª¿ã¹ãŸã¨ã“ã‚ã€ã€ŒOktaå´ã§MFAã‚’å®Œäº†ã—ãŸéš›ã®ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’Azure ADå´ã«æ¸¡ã™ã€ã¨ã„ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®šãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç„¡åŠ¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚

ã“ã®è¨­å®šã¯ `Settings > Features > O365 Pass Claim For MFA` ã«ã‚ãŸã‚‹ã®ã§ã“ã‚Œã‚’ã‚ªãƒ³ã«ã™ã‚‹ã“ã¨ã§ã€Windows Hello for Businessã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®šã¯æ±‚ã‚ã‚‰ã‚Œãªããªã‚Šã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/4090cafa675f6e865e2be4a7.png)

### Oktaã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ç›´å¾Œã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ãªãŠã•ãšã«SSOã™ã‚‹ã¨ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã«é™¥ã‚‹
ã“ã‚Œã¯å†ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹ã®ã«è‹¦åŠ´ã—ãŸã®ã§ã™ãŒã€Oktaã®ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦2ã€œ3åˆ†ã™ã‚‹ã¨ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœŸé™åˆ‡ã‚Œã¨ãªã‚‹ã‚ˆã†ã§ã€ãã®çŠ¶æ…‹ã§Oktaã«å†ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã›ãšã«Microsoft 365ã¸ã®SSOã‚’ã™ã‚‹ã¨ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢ã§ãƒ«ãƒ¼ãƒ—ã™ã‚‹ç¾è±¡ãŒç™ºç”Ÿã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/92cd7d405253e91ec33eca6b.gif)

Oktaå´ã«ã¯SSOãŒæˆåŠŸã—ãŸã‹ã®ã‚ˆã†ãªãƒ­ã‚°ã—ã‹å‡ºãªã„ã®ã§ã™ãŒã€Azure ADå´ã«ã¯StatusãŒFailureã§ä¸‹è¨˜ã®ãƒ­ã‚°ãŒãŸãã•ã‚“ç™ºç”Ÿã—ã¾ã™ã€‚
> The provided grant has expired due to it being revoked, a fresh auth token is needed. The user might have changed or reset their password. The grant was issued on '{authTime}' and the TokensValidFrom date (before which tokens are not valid) for this user is '{validDate}'.

ä¸€åº¦Oktaã‹ã‚‰ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆã—ã¦ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ç›´ã›ã°æ²»ã‚‹ã®ã§ã™ãŒã€ã§ãã‚Œã°è‡ªå‹•çš„ã«å†ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’ä¿ƒã™ç”»é¢ãŒå‡ºã¦ã»ã—ã„ã§ã™ã­ã€‚ï¼ˆãã†ã„ãˆã°Oktaã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã£ã¦ã©ã“ã‹ã‚‰ä¸Šã’ã‚‰ã‚Œã‚‹ã‚“ã ã‚ã†ï¼‰

# ã•ã„ã”ã«
è¨˜è¼‰å†…å®¹ã«å¯¾ã™ã‚‹æŒ‡æ‘˜ã‚„ä¿®æ­£ææ¡ˆã€ä¸æ˜ç‚¹ãŒã‚ã‚‹å ´åˆã¯ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã€GitHubã€[Twitter](https://twitter.com/thdy_jp)ç­‰ã¸ãŠé¡˜ã„ã—ã¾ã™ã€‚